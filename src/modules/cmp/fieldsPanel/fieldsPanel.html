<template>
  <div class="slds-tree_container">
    <div class="slds-p-left_small">
      <div class="slds-grid">
        <button class="slds-button slds-button_icon" title="Back" onclick={deselectSObject}>
          <svg class="slds-button__icon" aria-hidden="true">
            <use xlink:href="./resources/slds/icons/utility-sprite/svg/symbols.svg#back"></use>
          </svg>
          <span class="slds-assistive-text">Back</span>
        </button>
        <h2 class="slds-tree__group-header slds-truncate" if:true={sobjectMeta}>
          {sobjectMeta.name} / {sobjectMeta.label}
        </h2>
      </div>
    </div>
    <div class="slds-form-element slds-p-horizontal_large">
      <label class="slds-form-element__label slds-assistive-text">Filter fields</label>
      <div class="slds-form-element__control slds-input-has-icon slds-input-has-icon_left">
        <span class="slds-icon_container slds-icon-utility-search">
          <svg class="slds-icon slds-input__icon slds-input__icon_right slds-icon-text-default" aria-hidden="true">
            <use xlink:href="./resources/slds/icons/utility-sprite/svg/symbols.svg#search"></use>
          </svg>
        </span>
        <input type="search" placeholder="Quick Find" class="slds-input" onkeyup={filterFields} />
      </div>
    </div>
    <div class="slds-tabs_default">
      <ul class="slds-tabs_default__nav" role="tablist">
        <template for:each={tabs} for:item="tab">
          <li class="slds-tabs_default__item" aria-selected={tab.isActive} title={tab.label} key={tab.id}>
            <a class="slds-tabs_default__link" role="tab" tabindex="-1" onclick={selectTab} data-id={tab.id}>{tab.label}</a>
          </li>
        </template>
      </ul>
      <div class="slds-tabs_default__content" role="tabpanel" if:true={isFieldsActive}>
        <ul class="slds-tree left-panel-scrollable">
          <template for:each={fields} for:item="field">
            <li aria-level="1" aria-selected={field.isActive} role="treeitem" key={field.name}>
              <div class="slds-tree__item">
                <button class="slds-button slds-button_icon slds-m-right_x-small" aria-hidden={field.isNotReference}
                  tabindex="-1" title="Expand Reference Field"
                  onclick={expandReferenceField}>
                  <svg class="slds-button__icon slds-button__icon_small" aria-hidden="true">
                    <use xlink:href="./resources/slds/icons/utility-sprite/svg/symbols.svg#chevronright"></use>
                  </svg>
                  <span class="slds-assistive-text">Expand Reference Field</span>
                </button>
                <span class="slds-has-flexi-truncate">
                  <a class="slds-tree__item-label slds-truncate" title={field.name}
                    onclick={selectField} data-name={field.name}>
                    {field.name} / {field.label}
                  </a>
                </span>
              </div>
            </li>
          </template>
        </ul>
      </div>
      <div class="slds-tabs_default__content" role="tabpanel" if:true={isRelationshipsActive}>
        <ul class="slds-tree left-panel-scrollable">
          <template for:each={relationships} for:item="relation">
            <template if:true={relation.relationshipName}>
              <li aria-level="1" aria-selected={relation.isActive} role="treeitem" key={relation.relationshipName}>
                <div class="slds-tree__item">
                  <button class="slds-button slds-button_icon slds-m-right_x-small" aria-hidden="false"
                    tabindex="-1" title="Expand Child Relationship"
                    onclick={expandChildRelationship}>
                    <svg class="slds-button__icon slds-button__icon_small" aria-hidden="true">
                      <use xlink:href="./resources/slds/icons/utility-sprite/svg/symbols.svg#chevronright"></use>
                    </svg>
                    <span class="slds-assistive-text">Expand Child Relationship</span>
                  </button>
                  <span class="slds-has-flexi-truncate">
                    <a class="slds-tree__item-label slds-truncate" title={relation.relationshipName}
                      onclick={selectRelationship} data-name={relation.relationshipName}>
                      {relation.relationshipName} / {relation.childSObject}
                    </a>
                  </span>
                </div>
              </li>
            </template>
          </template>
        </ul>
      </div>
    </div>
  </div>
</template>